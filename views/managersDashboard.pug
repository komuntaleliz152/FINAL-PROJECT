doctype html
html
  head
    meta(charset='UTF-8')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    title Manager's Dashboard - Karibu Grocery Limited
    link(rel='preconnect' href='https://fonts.googleapis.com')
    link(rel='preconnect' href='https://fonts.gstatic.com' crossorigin='')
    link(href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap' rel='stylesheet')
    link(rel='stylesheet' href='/css/managersDashboard.css')
    link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css' integrity='sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==' crossorigin='anonymous' referrerpolicy='no-referrer')
    script(src='https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js')

  body
    .dashboard-container
      // Sidebar
      aside.sidebar
        h2 Karibu Grocery
        ul
          li
            a(href='/ManagerDashboard')
              i.fas.fa-home
              |  Home
          li
            a(href='/addCreditSale')
              i.fas.fa-list
              |  Credit Management
          li
            a(href='/addProduceSale')
              i.fas.fa-chart-line
              |  Sales
          li
            a(href='/addstock')
              i.fas.fa-box
              |  Stock
          li
            a(href='/addprocurement')
              i.fas.fa-shopping-cart
              |  Procurement

      // Main Content
      main.main-content
        .notification-area
          .notification-bell(onclick='toggleNotifications()')
            i.fas.fa-bell
            span#notification-count.badge 3
          .settings-icon
            i.fas.fa-cog
          #notification-dropdown.notification-dropdown
            h4 Notifications
            ul
              li New stock added: Beans
              li Customer order #223 completed
              li New message from the supplier

        header
          .header-container
            h1 Manager's Dashboard
            p Manage inventory, track sales, and monitor business operations

        section.overview
          if lowStockItems && lowStockItems.length > 0
            #alert-box.alert-box
              p Important: Inventory levels are low on some items!
              button(onclick='dismissAlert()') Dismiss

          // Statistics
          .statistics
            .stat-box
              h3 Sales Today
              p= todaySales ? `UGX ${todaySales.toLocaleString()}` : 'UGX 0'
            
            .stat-box
              h3 High Selling Product
              if topProduct
                p= topProduct._id
                p= `UGX ${topProduct.totalSales.toLocaleString()}`
              else
                p No data available
            
            .stat-box
              h3 Current Products
              if currentProducts && currentProducts.length > 0
                each product in currentProducts.slice(0, 3)
                  p= product
              else
                p No products in stock
            
            .stat-box
              h3 Low Stock Items
              if lowStockItems && lowStockItems.length > 0
                ul
                  each item in lowStockItems
                    li= `${item._id} – ${item.totalStock}kgs`
              else
                p All items well stocked
            
            .stat-box
              h3 Recent Orders
              if recentOrders && recentOrders.length > 0
                ul
                  each order in recentOrders
                    li= order.produceName
              else
                p No recent orders
            
            .stat-box
              h3 Available Stock
              if availableStock && availableStock.length > 0
                ul
                  each stock in availableStock
                    li= `${stock._id} – ${stock.totalStock}kgs`
              else
                p No stock available

        // Charts Section
        section.charts-section
          .chart-card
            h3 Sales Trend
            canvas#salesTrendChart
          
          .chart-card
            h3 Inventory Levels
            canvas#inventoryChart

    // Hidden data elements for JavaScript
    script(type='application/json' id='weeklySalesData')= weeklySalesData
    script(type='application/json' id='inventoryData')= inventoryData

    script(src='/js/managersDashboard.js')
